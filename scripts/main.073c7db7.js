"use strict";function TokenScanner(a){var b=a,c={},d=0;this.addToken=function(a,b){if(void 0!==c[a])throw"Token already added.";c[a]=b},this.hasNext=function(){this.curTokenType=null;var a=!1,b=Object.keys(c);for(var d in b)if(!/^&/.test(b[d])&&this.hasNextExp(c[b[d]])){this.curTokenType=b[d],a=!0;break}if(!a)for(var d in b)if(/^&/.test(b[d])&&this.hasNextExp(c[b[d]])){this.curTokenType=b[d],a=!0;break}return a},this.hasNextPat=function(a){return this.hasNextExp(c[a])},this.hasNextExp=function(a){var c=!1,e=new RegExp("^"+a);if(d<b.length){var f=b.substring(d).match(e);f&&(this.curToken=f[0],c=!0)}return c},this.next=function(){return this.nextExp(c[this.curTokenType])},this.nextPat=function(a){return this.nextExp(c[a])},this.nextExp=function(a){var c=new RegExp("^"+a),e=b.substring(d).match(c)[0];return d+=e.length,/^\s+/.test(b.substring(d))&&(d+=b.substring(d).match(/^\s+/)[0].length),e}}function ExpressionNode(){var a,b,c;this.getData=function(){return a},this.getLeft=function(){return b},this.getRight=function(){return c},this.setData=function(b){a=b},this.setLeft=function(a){b=a},this.setRight=function(a){c=a}}function ExpressionOperator(operator){function conjugate(a,b,c,d){return d[b].replace(/##left##/,a).replace(/##right##/,c)}var node=new ExpressionNode;return node.setData(operator),node.evaluate=function(subExpressions){var lex={"!":"!(##left##)","&":"(##left##&&##right##)","|":"(##left##||##right##)","^":"!!(##left##^##right##)","?":"(!##left##||##right##)"},left=node.getLeft().evaluate(subExpressions).peek(),right=node.getRight()?node.getRight().evaluate(subExpressions).peek():void 0,exp=conjugate(left,node.getData(),right,lex),val=eval(exp);return subExpressions.push(val),subExpressions},node.toString=function(a){var b={"!":"&not;##left##","&":"(##left##&and;##right##)","|":"(##left##&or;##right##)","^":"(##left##&oplus;##right##)","?":"(##left##&rarr;##right##)"},c=node.getLeft().toString(a).peek(),d=node.getRight()?node.getRight().toString(a).peek():void 0;return a.push(conjugate(c,node.getData(),d,b)),a},node}function ExpressionOperand(a){var b=new ExpressionNode,c=this,d=c.getIndex();return b.setData(a),b.evaluate=function(a){return a.push(0!==(c.getActiveBits()&d)),a},b.toString=function(a){return a.push(b.getData()),a},b}function BinaryPowerSet(){var a=0,b=0;this.getIndex=function(){return 1<<a++},this.getBitCount=function(){return a},this.getActiveBits=function(){return b},this.setActiveBits=function(a){b=a}}function ExpressionTree(a){var b=ExpressionOperand.prototype=new BinaryPowerSet,c=parsePostfix(toPostfix(a));this.evaluate=function(a){return b.setActiveBits(a),c.evaluate([])},this.getExpression=function(){return c.toString([])},this.getNumTerms=function(){return b.getBitCount()}}function toPostfix(a){var b=[],c=[],d=new TokenScanner(a);for(d.addToken("op","["+sOps+"]"),d.addToken("term","[^"+sOps+"\\s]+");d.hasNext();)if(d.hasNextPat("op")){var e=d.nextPat("op");switch(e){case"(":c.push(e);break;case"!":c.push(e);break;case"&":for(;!c.isEmpty()&&"("!==c.peek();)b.push(c.pop());c.push(e);break;case"|":case"^":for(;!c.isEmpty()&&"("!==c.peek()&&"&"!==c.peek();)b.push(c.pop());c.push(e);break;case"?":for(;!c.isEmpty()&&"("!==c.peek()&&"&"!==c.peek()&&"|"!==c.peek()&&"^"!==c.peek();)b.push(c.pop());c.push(e);break;case")":for(;!c.isEmpty()&&"("!==c.peek();)b.push(c.pop());c.pop(),c.isEmpty()||"!"!==c.peek()||b.push(c.pop())}}else b.push(d.nextPat("term"));for(;c.length;)b.push(c.pop());return b.join(" ")}function parsePostfix(a){var b=[],c=[],d=new TokenScanner(a);for(d.addToken("op","["+sOps+"]"),d.addToken("term","[^"+sOps+"\\s]+");d.hasNext();)if(d.hasNextPat("op")){var e=new ExpressionOperator(d.nextPat("op"));if(b.isEmpty())throw"Parse error: insufficient operands prior to operator";if("!"!==e.getData()){var f=b.pop();e.setRight(f)}if(b.isEmpty())throw"Parse error: insufficient operands prior to operator";var g=b.pop();e.setLeft(g),b.push(e)}else{for(var h,i=d.nextPat("term"),j=null,k=0;k<c.length;++k)if(c[k].getData()===i){j=c[k];break}null===j?(h=new ExpressionOperand(i),c.push(h)):h=j,b.push(h)}return b.pop()}ExpressionOperand.prototype=new BinaryPowerSet;var sOps="!&\\|\\^\\?\\(\\)";Array.prototype.isEmpty=function(){return 0===this.length},Array.prototype.peek=function(){return this[this.length-1]},function(a){a.fn.truthtable=function(){var b,c;return this.generateTable=function(d){var e=new ExpressionTree(d),f=0,g={},h=[],i=e.getExpression().filter(function(a){var b=void 0===g[a];return b&&(g[a]=!0),h.push(b),b}).map(function(a){var b=f++;return{id:b,name:a,field:b,minWidth:50}});c=i[i.length-1].name;for(var j=[],k=e.getNumTerms(),l=Math.pow(2,k)-1;l>=0;--l){var m=0,n=0;j.push(e.evaluate(l).filter(function(){return h[n++]}).reduce(function(a,b){return a[m++]=b?"True":"False",a},{}))}var o={autoHeight:!0,enableColumnReorder:!1};b=new Slick.Grid(this,j,i,o);var p=41,q=0;a("span.slick-column-name").map(function(b){var c=a(this).width();q+=i[b].width=c+p}),b.setColumns(i),a("#truthtable").width(q)},this.getExpression=function(){return c},this}}(jQuery),$(document).ready(function(){$(window).resize(function(){$("#inputField").height($("#inputField").data("height")||$(window).height())}),$(window).resize();var a=$("#truthtable"),b=a.truthtable();$("#inputField").keypress(function(c){switch(c.which){case 13:$("#inputLabel").fadeOut(),$("#inputField").animate({height:50}),$("#inputField").data("height",50),b.generateTable($("#expression").val()),a.css({border:"1px solid"}),$("#title").html("Truth table for "+b.getExpression())}})});